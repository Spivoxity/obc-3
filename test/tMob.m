MODULE tMob;

IMPORT Out;

TYPE Fun = PROCEDURE (): REAL;

PROCEDURE A(k: INTEGER; x1, x2, x3, x4, x5: Fun): REAL;
  PROCEDURE B(): REAL;
  BEGIN
    k := k-1;
    RETURN A(k, B, x1, x2, x3, x4)
  END B;
BEGIN
  IF k <= 0 THEN RETURN x4() + x5() ELSE RETURN B() END
END A;

PROCEDURE One(): REAL; BEGIN RETURN 1 END One;
PROCEDURE MOne(): REAL; BEGIN RETURN -1 END MOne;
PROCEDURE Zero(): REAL; BEGIN RETURN 0 END Zero;

BEGIN
  Out.Real(A(10, One, MOne, MOne, One, Zero)); Out.Ln
END tMob.

(*<<
-67.0000
>>*)

(*[[
!! SYMFILE #tMob STAMP #tMob.%main 1
!! END STAMP
!! 
MODULE tMob STAMP 0
IMPORT Out STAMP
ENDHDR

PROC tMob.%1.B 4 12 0
!   PROCEDURE B(): REAL;
SAVELINK
!     k := k-1;
LDEW 12
DEC
STEW 12
!     RETURN A(k, B, x1, x2, x3, x4)
LDEW 44
LDEW 40
LDEW 36
LDEW 32
LDEW 28
LDEW 24
LDEW 20
LDEW 16
LDLW -4
GLOBAL tMob.%1.B
LDEW 12
GLOBAL tMob.A
CALLF 11
RETURNF
END

PROC tMob.A 0 12 0
! PROCEDURE A(k: INTEGER; x1, x2, x3, x4, x5: Fun): REAL;
!   IF k <= 0 THEN RETURN x4() + x5() ELSE RETURN B() END
LDLW 12
JGTZ 4
LDLW 44
LINK
LDLW 40
NCHECK 14
CALLF 0
LDLW 52
LINK
LDLW 48
NCHECK 14
CALLF 0
FPLUS
RETURNF
LABEL 4
LOCAL 0
LINK
GLOBAL tMob.%1.B
CALLF 0
RETURNF
END

PROC tMob.One 0 12 0
! PROCEDURE One(): REAL; BEGIN RETURN 1 END One;
FCONST 1.0
RETURNF
END

PROC tMob.MOne 0 12 0
! PROCEDURE MOne(): REAL; BEGIN RETURN -1 END MOne;
FCONST -1.0
RETURNF
END

PROC tMob.Zero 0 12 0
! PROCEDURE Zero(): REAL; BEGIN RETURN 0 END Zero;
FCONST 0.0
RETURNF
END

PROC tMob.%main 0 12 0
!   Out.Real(A(10, One, MOne, MOne, One, Zero)); Out.Ln
CONST 0
GLOBAL tMob.Zero
CONST 0
GLOBAL tMob.One
CONST 0
GLOBAL tMob.MOne
CONST 0
GLOBAL tMob.MOne
CONST 0
GLOBAL tMob.One
CONST 10
GLOBAL tMob.A
CALLF 11
GLOBAL Out.Real
CALL 1
GLOBAL Out.Ln
CALL 0
RETURN
END

! End of file
]]*)
